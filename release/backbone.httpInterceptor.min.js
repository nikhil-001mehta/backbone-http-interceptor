var vent;!function(e){"use strict";if("function"==typeof define&&define.amd)define("backboneHttpInterceptor",["jquery","backbone","underscore","vent"],e);else if("undefined"!=typeof module&&module.exports){var t=require("jquery"),o=require("backbone"),s=require("underscore");module.exports=e(t,o,s)}else e($,Backbone,_,vent)}(function(e,t,o){"use strict";if(!t)throw"Please include Backbone.js before Backbone.HttpInterceptor.js";t.HttpInterceptor=function(){_.bindAll.apply(_,[this].concat(_.functions(this)))};var s,r,n=[],a={},c=function(){return o.reject(n,function(e){return 4===e.readyState})},l=function(t,o){"create"!==t&&"update"!==t&&"patch"!==t&&"read"!==t||(e(a.spinnerTextSelector).text(o.spinnerText||a.defaultSpinnerText),e(a.spinnerSelector).css("display",a.spinnerDisplayStyle||"block")),this.once("sync",function(){n=c(),0===n.length&&e(a.spinnerSelector).css("display","none"),!o.doNotshowToaster&&r&&(e(a.toasterSelector).addClass(a.toasterSuccessClass),e(a.toasterTextSelector).text(o.toasterText||a.defaultToasterText),e(a.toasterSelector).css("display",a.toasterDisplayStyle),e(a.toasterSelector).delay(5e3).fadeOut("slow"),e(a.toasterSelector).removeClass(a.toasterSuccessClass)),this.cancelRequest&&delete this.cancelRequest,this.off("error")}),this.once("error",function(t,s){e(a.spinnerSelector).css("display","none"),"abort"!==s.statusText&&!o.doNotshowToaster&&r&&(e(a.toasterSelector).addClass(a.toasterErrorClass),e(a.toasterTextSelector).text(o.toasterText||a.defaultToasterText),e(a.toasterSelector).css("display",a.toasterDisplayStyle),e(a.toasterSelector).delay(5e3).fadeOut("slow"),e(a.toasterSelector).removeClass(a.toasterErrorClass)),this.cancelRequest&&delete this.cancelRequest,this.off("sync")})},i=function(){o.invoke(n,"abort"),n=[]},p=function(e){if(!e)throw"Please pass options to Backbone.HttpInterceptor.start";a=_.extend(a,e),s=!!e.spinnerSelector,r=!!e.toasterSelector},u=function(e){p(e),t.Model.prototype.sync=t.Collection.prototype.sync=function(e,r,a){var i=o.bind(l,this),p=t.sync.apply(this,arguments);return!a.doNotshowSpinner&&s&&i(e,a),a.doNotAbort||(n.push(p),this.cancelRequest=function(){p.abort()}),n=c(),p}};return t.HttpInterceptor.VERSION="1.0.0",_.extend(t.HttpInterceptor.prototype,{setOptions:p,start:u,abortAllPendingRequests:i}),t.httpInterceptor});