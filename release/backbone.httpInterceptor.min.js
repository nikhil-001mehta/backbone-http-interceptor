var vent;!function(e){"use strict";"function"==typeof define&&define.amd?(vent=require("vent"),vent||define("vent",["backbone"],function(e){return new e.Wreqr.EventAggregator}),define("backboneHttpInterceptor",["jquery","backbone","underscore","vent"],e)):(vent=vent||new backbone.Wreqr.EventAggregator,e($,Backbone,underscore,vent))}(function(e,t,o,r){"use strict";if(!t)throw"Please include Backbone.js before Backbone.HttpInterceptor.js";t.HttpInterceptor=function(){_.bindAll.apply(_,[this].concat(_.functions(this)))};var s,n,a=[],c={},i=function(){return o.reject(a,function(e){return 4===e.readyState})},l=function(t,o){"create"!==t&&"update"!==t&&"patch"!==t&&"read"!==t||(e(c.spinnerTextSelector).text(o.spinnerText||c.defaultSpinnerText),e(c.spinnerSelector).css("display",c.spinnerDisplayStyle||"block")),this.once("sync",function(){a=i(),0===a.length&&e(c.spinnerSelector).css("display","none"),!o.doNotshowToaster&&n&&(e(c.toasterSelector).addClass(c.toasterSuccessClass),e(c.toasterTextSelector).text(o.toasterText||c.defaultToasterText),e(c.toasterSelector).css("display",c.toasterDisplayStyle),e(c.toasterSelector).delay(5e3).fadeOut("slow"),e(c.toasterSelector).removeClass(c.toasterSuccessClass)),this.cancelRequest&&delete this.cancelRequest,this.off("error")}),this.once("error",function(t,r){e(c.spinnerSelector).css("display","none"),"abort"!==r.statusText&&!o.doNotshowToaster&&n&&(e(c.toasterSelector).addClass(c.toasterErrorClass),e(c.toasterTextSelector).text(o.toasterText||c.defaultToasterText),e(c.toasterSelector).css("display",c.toasterDisplayStyle),e(c.toasterSelector).delay(5e3).fadeOut("slow"),e(c.toasterSelector).removeClass(c.toasterErrorClass)),this.cancelRequest&&delete this.cancelRequest,this.off("sync")})},p=function(){o.invoke(a,"abort"),a=[]},u=function(e){if(!e)throw"Please pass options to Backbone.HttpInterceptor.start";c=_.extend(c,e),s=!!e.spinnerSelector,n=!!e.toasterSelector},d=function(e){u(e),t.Model.prototype.sync=t.Collection.prototype.sync=function(e,r,n){var c=o.bind(l,this),p=t.sync.apply(this,arguments);return!n.doNotshowSpinner&&s&&c(e,n),n.doNotAbort||(a.push(p),this.cancelRequest=function(){p.abort()}),a=i(),p}};return t.HttpInterceptor.VERSION="1.0.0",_.extend(t.HttpInterceptor.prototype,{setOptions:u,start:d,abortAllPendingRequests:p}),t.httpInterceptor});